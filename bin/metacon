#!/usr/bin/env ruby
# Essentially just a wrapper around .metacon_unwrapped that makes sure it uses
# the correct ruby version + gemset.

rvm_path = File.expand_path("~/.rvm/scripts/rvm")
if File.exists?(rvm_path)
  require 'shellwords'
  cmd = Shellwords.shellescape(File.join(File.dirname(__FILE__), '.metacon_unwrapped'))
  full_cmd = '. "$HOME/.rvm/scripts/rvm" && rvm ruby-1.9.2@metacon exec ' + cmd + ' ' + ARGV.map{|a| Shellwords.shellescape(a)}.join(' ')
  exec full_cmd
else
  $stderr.puts "RVM is required to run metacon. To finish installation of metacon please run metacon-installer"
end
